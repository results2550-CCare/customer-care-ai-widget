<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Customer Care AI — WOW Monster + Hands-Free Voice</title>
  <style>
    :root{
      --bg0:#05060a; --bg1:#081022; --bg2:#0b1a3a;
      --stroke: rgba(255,255,255,.14);
      --txt: rgba(255,255,255,.92); --muted: rgba(255,255,255,.72);
      --accent:#ff8a00; --accent2:#ffd36a; --green:#56ff7a;
      --shadow: 0 30px 90px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
      color:var(--txt); overflow-x:hidden;
      background:
        radial-gradient(900px 500px at 30% 15%, rgba(255,138,0,.18), transparent 60%),
        radial-gradient(900px 500px at 70% 20%, rgba(70,140,255,.12), transparent 60%),
        radial-gradient(900px 600px at 50% 90%, rgba(0,255,170,.08), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 45%, var(--bg2));
    }
    .bg-motion{
      position:fixed; inset:-40vh -40vw; pointer-events:none; opacity:.9;
      background:
        radial-gradient(600px 300px at 30% 60%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(500px 250px at 70% 70%, rgba(255,255,255,.05), transparent 60%),
        radial-gradient(700px 360px at 50% 85%, rgba(255,138,0,.05), transparent 60%);
      filter: blur(20px);
      animation: drift 18s linear infinite;
    }
    @keyframes drift{0%{transform:translate3d(-2%,0,0) rotate(0)}50%{transform:translate3d(2%,-1%,0) rotate(2deg)}100%{transform:translate3d(-2%,0,0) rotate(0)}}

    .wrap{min-height:100%; display:flex; align-items:center; justify-content:center; padding:28px 16px 44px; position:relative; z-index:2;}
    .stage{
      width:min(1040px, 96vw); position:relative;
      border:1px solid rgba(255,255,255,.10);
      border-radius:22px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .topbar{padding:22px 22px 10px;}
    .title h1{margin:0; font-size: clamp(28px, 4vw, 44px); letter-spacing:.2px;}
    .title p{margin:8px 0 0; color:var(--muted); line-height:1.35; max-width:70ch;}
    .grid{display:grid; grid-template-columns: 1.08fr .92fr; gap:16px; padding:16px 22px 24px;}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }

    .panel{border:1px solid var(--stroke); background: rgba(0,0,0,.18); border-radius:18px; overflow:hidden; position:relative;}
    .panel-hd{
      padding:12px 14px; display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-weight:700;
    }
    .panel-hd small{font-weight:650; color:rgba(255,255,255,.70);}
    .panel-bd{padding:14px; position:relative; min-height: 390px;}

    .formbox{
      position:relative; border-radius:16px;
      background: rgba(255,255,255,.04);
      border:1px dashed rgba(255,255,255,.22);
      padding:16px; overflow:hidden;
    }
    .field{
      height:46px; border-radius:12px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.10);
      margin:12px 0; display:flex; align-items:center;
      padding:0 14px; color:rgba(255,255,255,.55); user-select:none;
    }
    .field.big{height:112px; align-items:flex-start; padding-top:12px}
    .btn{
      margin-top:14px; height:54px; border-radius:14px; border:0;
      background: linear-gradient(180deg, var(--accent2), var(--accent));
      color:#1a1206; font-weight:900; font-size:16px;
      width:100%; box-shadow:0 12px 32px rgba(255,138,0,.28);
      user-select:none; cursor:pointer;
    }

    .reveal{position:absolute; inset:0; z-index:20; opacity:0; transform: translateY(14px); transition: opacity .65s ease, transform .65s ease; pointer-events:none;}
    .reveal.on{opacity:1; transform: translateY(0); pointer-events:auto;}
    .cleanCard{border-radius:18px; border:1px solid rgba(255,255,255,.14); background: rgba(12,18,35,.58); overflow:hidden;}
    .cleanHd{padding:12px 14px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.05); font-weight:900;}
    .cleanBd{padding:14px; color:rgba(255,255,255,.78); line-height:1.35;}

    .widget{margin-top:12px; border-radius:16px; border:1px solid rgba(255,255,255,.16); background: rgba(0,0,0,.22); overflow:hidden;}
    .widgetTop{padding:10px 12px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.04); gap:10px;}
    .widgetTitle{display:flex; align-items:center; gap:10px; font-weight:850;}
    .orb{width:14px; height:14px; border-radius:999px; background: radial-gradient(circle at 30% 30%, #fff, var(--accent) 40%, rgba(255,138,0,.25) 70%); box-shadow: 0 0 22px rgba(255,138,0,.35);}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.18); font-size:12px; color:rgba(255,255,255,.80); user-select:none;}
    .chip .s{width:8px;height:8px;border-radius:50%; background:rgba(255,255,255,.35);}
    .chip.on .s{background: var(--green); box-shadow:0 0 16px rgba(86,255,122,.55);}

    .widgetBody{padding:12px}
    .log{height:160px; overflow:auto; border:1px solid rgba(255,255,255,.12); border-radius:14px; background: rgba(0,0,0,.18); padding:10px; font-size:13px; line-height:1.35; color:rgba(255,255,255,.82);}
    .m{margin:8px 0}
    .row{display:flex; gap:10px; margin-top:10px;}
    .inp{flex:1; height:44px; border-radius:14px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.18); color:rgba(255,255,255,.90); padding:0 12px; outline:none; font-weight:650;}
    .send{height:44px; border-radius:14px; border:0; background: linear-gradient(180deg, var(--accent2), var(--accent)); color:#1a1206; font-weight:950; padding:0 14px; cursor:pointer;}

    /* Simple cinematic bits */
    .monster{position:absolute; width:min(520px, 88vw); height:min(520px, 88vw); left:50%; top:66%;
      transform: translate(-50%,-50%) scale(.35); opacity:0; z-index:40; pointer-events:none;
      filter: drop-shadow(0 30px 50px rgba(0,0,0,.65));
    }
    @keyframes monsterIn{
      0%{opacity:0; transform: translate(-50%,-50%) scale(.20) rotate(-6deg);}
      25%{opacity:1;}
      55%{transform: translate(-50%,-55%) scale(.85) rotate(2deg);}
      100%{opacity:1; transform: translate(-50%,-52%) scale(.95) rotate(0deg);}
    }

    /* TAP overlay (this is the “one interaction” required by browsers) */
    .tapOverlay{
      position:fixed; inset:0; z-index:9999;
      display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
      padding:20px;
    }
    .tapOverlay.on{display:flex;}
    .tapCard{
      width:min(720px, 92vw);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(10,12,18,.82);
      box-shadow: 0 30px 90px rgba(0,0,0,.6);
      padding:18px;
      text-align:center;
    }
    .tapCard h2{margin:6px 0 8px; font-size:22px;}
    .tapCard p{margin:0 0 14px; color:rgba(255,255,255,.72); line-height:1.35;}
    .tapBtn{
      width:100%;
      height:56px;
      border-radius:16px;
      border:0;
      background: linear-gradient(180deg, var(--accent2), var(--accent));
      color:#1a1206;
      font-weight:950;
      font-size:16px;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="bg-motion"></div>

  <div class="tapOverlay" id="tapOverlay">
    <div class="tapCard">
      <h2>Tap to start hands-free voice</h2>
      <p>Browser security requires one user tap to enable microphone + audio. After this, the demo runs hands-free.</p>
      <button class="tapBtn" id="tapStartBtn" type="button">START VOICE</button>
    </div>
  </div>

  <div class="wrap">
    <div class="stage" id="stage">
      <div class="topbar">
        <div class="title">
          <h1>Customer Care AI</h1>
          <p>Monster tears the boring form apart → clean voice-first experience appears. One tap to satisfy browser mic security, then hands-free loop.</p>
        </div>
      </div>

      <div class="grid">
        <div class="panel">
          <div class="panel-hd">Clean Reveal <small>voice-first</small></div>
          <div class="panel-bd">
            <div class="cleanCard reveal" id="revealLeft" aria-hidden="true">
              <div class="cleanHd">
                Customer Care AI
                <span style="color:rgba(255,255,255,.70);font-weight:800;">Hands-Free Demo</span>
              </div>
              <div class="cleanBd">
                <div>Speak normally after you tap START once. It auto-listens and replies.</div>

                <div class="widget">
                  <div class="widgetTop">
                    <div class="widgetTitle"><span class="orb"></span> Voice Agent</div>
                    <div class="chip" id="micState"><span class="s"></span><span id="micLabel">Mic: waiting…</span></div>
                  </div>
                  <div class="widgetBody">
                    <div class="log" id="log"></div>
                    <div class="row">
                      <input class="inp" id="textIn" placeholder="Type is optional…" />
                      <button class="send" id="sendBtn" type="button">Send</button>
                    </div>
                    <div class="muted" style="margin-top:8px;font-size:12px;">
                      If the mic permission prompt appears, hit Allow.
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-hd">Old Website Form <small>gets destroyed</small></div>
          <div class="panel-bd">
            <div class="formbox" id="formBox">
              <div class="field">First name</div>
              <div class="field">Last name</div>
              <div class="field">Email address</div>
              <div class="field">Phone number</div>
              <div class="field big">Message</div>
              <button class="btn" type="button" id="fakeSubmit">Submit</button>
            </div>

            <svg class="monster" id="monster" viewBox="0 0 500 500" aria-hidden="true">
              <defs>
                <linearGradient id="mG" x1="0" x2="1">
                  <stop offset="0" stop-color="#0b0f18"/>
                  <stop offset="0.55" stop-color="#0a0c14"/>
                  <stop offset="1" stop-color="#070912"/>
                </linearGradient>
              </defs>
              <path d="M250 55c75 0 130 40 150 95 26 70-6 162-55 220-42 49-83 75-140 75-57 0-98-26-140-75-49-58-81-150-55-220 20-55 75-95 150-95z"
                    fill="rgba(0,0,0,.20)" stroke="rgba(255,255,255,.10)" stroke-width="6"/>
              <path d="M120 245c10-75 65-140 130-150 68-10 125 32 150 90 18 42 12 92-10 130-20 36-46 60-78 73-44 18-94 16-132-8-41-26-70-70-60-135z"
                    fill="url(#mG)" stroke="rgba(255,255,255,.08)" stroke-width="4"/>
              <ellipse cx="205" cy="220" rx="18" ry="10" fill="rgba(86,255,122,.92)"/>
              <ellipse cx="295" cy="220" rx="18" ry="10" fill="rgba(86,255,122,.92)"/>
            </svg>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
(() => {
  // ====== UI refs ======
  const revealLeft = document.getElementById('revealLeft');
  const formBox = document.getElementById('formBox');
  const monster = document.getElementById('monster');
  const fakeSubmit = document.getElementById('fakeSubmit');

  const tapOverlay = document.getElementById('tapOverlay');
  const tapStartBtn = document.getElementById('tapStartBtn');

  const logEl = document.getElementById('log');
  const textIn = document.getElementById('textIn');
  const sendBtn = document.getElementById('sendBtn');
  const micState = document.getElementById('micState');
  const micLabel = document.getElementById('micLabel');

  // ====== Helpers ======
  function addMsg(who, text){
    const div = document.createElement('div');
    div.className = 'm';
    div.textContent = `${who}: ${text}`;
    logEl.appendChild(div);
    logEl.scrollTop = logEl.scrollHeight;
  }
  function setMicUI(on, label){
    micState.classList.toggle('on', !!on);
    micLabel.textContent = label;
  }

  // ====== Cinematic ======
  function playCinematic(){
    monster.style.animation = 'monsterIn .65s cubic-bezier(.2,.9,.2,1) forwards';
    monster.style.opacity = '1';

    // destroy form (simple shrink fade)
    formBox.animate([
      { transform:'scale(1)', opacity:1 },
      { transform:'scale(.93) rotate(-.6deg)', opacity:0 }
    ], { duration:900, easing:'ease', fill:'forwards', delay:420 });

    // reveal engine
    setTimeout(() => {
      revealLeft.classList.add('on');
    }, 1400);

    // after cinematic, show tap overlay (security requirement)
    setTimeout(() => {
      tapOverlay.classList.add('on');
    }, 2000);
  }
  setTimeout(playCinematic, 2000);
  fakeSubmit.addEventListener('click', () => location.reload());

  // ====== Speech + “hands-free” loop ======
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  let rec = null;
  let autoListen = false;
  let isStarting = false;

  function speak(text){
    if(!('speechSynthesis' in window)) return;
    try{
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'en-AU';
      window.speechSynthesis.speak(u);
    }catch(_){}
  }

  async function sendToAI(message){
    addMsg('You', message);
    try{
      // If you deploy on Vercel with /api/chat.js, this works:
      const res = await fetch('/api/chat', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ message })
      });
      const data = await res.json().catch(()=> ({}));
      const reply = data.reply || 'No reply returned.';
      addMsg('AI', reply);
      speak(reply);
    }catch(e){
      addMsg('System', 'API error: ' + (e?.message || String(e)));
    }
  }

  function safeStartRec(){
    if(!rec || isStarting) return;
    try{
      isStarting = true;
      rec.start();
      setMicUI(true, 'Mic: listening…');
    }catch(_){}
    finally{
      setTimeout(()=> (isStarting=false), 350);
    }
  }

  function startHandsFree(){
    if(!SpeechRecognition){
      addMsg('System', 'Speech recognition not supported on this browser.');
      setMicUI(false, 'Mic: unsupported');
      return;
    }

    if(autoListen) return;
    autoListen = true;

    rec = new SpeechRecognition();
    rec.lang = 'en-AU';
    rec.continuous = true;
    rec.interimResults = false;

    rec.onresult = (event) => {
      const t = event?.results?.[event.resultIndex]?.[0]?.transcript || '';
      const text = t.trim();
      if(text) sendToAI(text);
      setMicUI(true, 'Mic: listening…');
    };

    rec.onerror = (e) => {
      const err = e?.error || 'unknown';
      if(err === 'not-allowed' || err === 'service-not-allowed'){
        autoListen = false;
        setMicUI(false, 'Mic: blocked');
        addMsg('System', 'Mic permission blocked. Enable mic permission for this site.');
        return;
      }
      setMicUI(true, 'Mic: retrying…');
    };

    rec.onend = () => {
      if(!autoListen) return;
      setMicUI(true, 'Mic: restarting…');
      setTimeout(safeStartRec, 250);
    };

    // MUST be triggered by a tap (this is that tap)
    safeStartRec();

    // greeting after mic starts
    addMsg('AI', 'Hi. Speak normally — I will listen and reply hands-free.');
    speak('Hi. Speak normally. I will listen hands free and reply.');
  }

  // Tap overlay button: one tap unlocks mic + speech.
  tapStartBtn.addEventListener('click', () => {
    tapOverlay.classList.remove('on');
    startHandsFree();
  });

  // Text fallback (optional)
  sendBtn.addEventListener('click', () => {
    const t = (textIn.value || '').trim();
    if(!t) return;
    textIn.value = '';
    sendToAI(t);
  });
  textIn.addEventListener('keydown', (e)=> {
    if(e.key === 'Enter') sendBtn.click();
  });

  addMsg('AI', 'Cinematic demo loading…');
  setMicUI(false, 'Mic: waiting…');
})();
</script>
</body>
</html>
